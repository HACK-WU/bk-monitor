# GSEé›†æˆ

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨æ–‡ä»¶**   
- [gse_process_event.py](file://bkmonitor\alarm_backends\service\access\event\records\gse_process_event.py)
- [gse_event.py](file://bkmonitor\alarm_backends\service\access\event\records\gse_event.py)
- [gse_tool.py](file://bkmonitor\bkm_ipchooser\tools\gse_tool.py)
- [default.py](file://bkmonitor\api\gse\default.py)
- [GSE(é€šç”¨æœåŠ¡å¼•æ“).md](file://wiki\GSE(é€šç”¨æœåŠ¡å¼•æ“).md)
- [test_records.py](file://bkmonitor\alarm_backends\tests\service\access\event\test_records.py)
- [resources.py](file://bkmonitor\packages\monitor_web\commons\job\resources.py)
- [processor.py](file://bkmonitor\alarm_backends\service\access\data\processor.py)
</cite>

## ç›®å½•
1. [å¼•è¨€ä¸èƒŒæ™¯](#å¼•è¨€ä¸èƒŒæ™¯)
2. [GSEæ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„](#gseæ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„)
3. [GSEåœ¨bkmonitorä¸­çš„é›†æˆæœºåˆ¶](#gseåœ¨bkmonitorä¸­çš„é›†æˆæœºåˆ¶)
4. [ä»»åŠ¡åˆ†å‘ã€ç»“æœå›è°ƒä¸é”™è¯¯å¤„ç†](#ä»»åŠ¡åˆ†å‘ç»“æœå›è°ƒä¸é”™è¯¯å¤„ç†)
5. [APIæ¥å£æ–‡æ¡£](#apiæ¥å£æ–‡æ¡£)
6. [GSEé€šé“ä¸æƒé™ç­–ç•¥é…ç½®](#gseé€šé“ä¸æƒé™ç­–ç•¥é…ç½®)
7. [å®é™…åº”ç”¨åœºæ™¯](#å®é™…åº”ç”¨åœºæ™¯)
8. [å¸¸è§é—®é¢˜æ’æŸ¥ä¸ç›‘æ§å»ºè®®](#å¸¸è§é—®é¢˜æ’æŸ¥ä¸ç›‘æ§å»ºè®®)

## å¼•è¨€ä¸èƒŒæ™¯

æœ¬æŠ¥å‘Šæ—¨åœ¨å…¨é¢é˜è¿°è…¾è®¯è“é²¸ä½“ç³»ä¸­çš„GSEï¼ˆé€šç”¨æœåŠ¡å¼•æ“ï¼‰ç»„ä»¶åœ¨bkmonitoré¡¹ç›®ä¸­çš„é›†æˆæ–¹æ¡ˆã€‚GSEä½œä¸ºè“é²¸å¹³å°çš„åº•å±‚åˆ†å¸ƒå¼ç®¡æ§å¹³å°ï¼Œæ˜¯å®ç°å¤§è§„æ¨¡è‡ªåŠ¨åŒ–è¿ç»´çš„ç¥ç»ä¸­æ¢å’Œå‘½ä»¤ç®¡é“ã€‚æœ¬æŠ¥å‘Šå°†è¯¦ç»†è¯´æ˜å…¶åœ¨ç›‘æ§æ•°æ®é‡‡é›†ã€å‘Šè­¦å¤„ç†æ‰§è¡Œã€é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²ç­‰æ–¹é¢çš„æ ¸å¿ƒä½œç”¨ï¼Œå¹¶æ·±å…¥è§£æå…¶ä»»åŠ¡åˆ†å‘ã€ç»“æœå›è°ƒå’Œé”™è¯¯å¤„ç†æµç¨‹ã€‚

#### **1.1. ç ”ç©¶ç›®çš„ä¸æ—¥æœŸ**

æœ¬ç ”ç©¶äº2025å¹´8æœˆ26æ—¥è¿›è¡Œï¼Œç›®æ ‡æ˜¯å…¨é¢ã€å‡†ç¡®åœ°é˜è¿°è…¾è®¯è“é²¸ä½“ç³»ä¸­çš„GSEç»„ä»¶æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ã€‚æŠ¥å‘Šå°†æ•´åˆåˆ†æç°æœ‰èµ„æ–™ï¼Œå˜æ¸…å…¶å®šä¹‰ï¼Œæ˜ç¡®å…¶åŠŸèƒ½ï¼Œå¹¶æ¢è®¨å…¶åœ¨æ•´ä¸ªè“é²¸ç”Ÿæ€ä¸­çš„æˆ˜ç•¥åœ°ä½ã€‚

#### **1.2. å…³é”®æœ¯è¯­æ¾„æ¸…ï¼šGSEçš„å¤šé‡å«ä¹‰**

åœ¨ç ”ç©¶åˆæœŸï¼Œæˆ‘ä»¬å‘ç°â€œGSEâ€è¿™ä¸€ç¼©å†™åœ¨ä¸åŒæŠ€æœ¯è¯­å¢ƒä¸‹å­˜åœ¨å¤šç§æˆªç„¶ä¸åŒçš„å«ä¹‰ï¼Œä¸ºé¿å…æ··æ·†ï¼Œç‰¹æ­¤æ¾„æ¸…ï¼š

*   **è“é²¸ä½“ç³»ä¸­çš„GSEï¼ˆGeneral Service Engineï¼‰** ï¼šè¿™æ˜¯æœ¬æŠ¥å‘Šçš„æ ¸å¿ƒç ”ç©¶å¯¹è±¡ï¼Œå³â€œé€šç”¨æœåŠ¡å¼•æ“â€ï¼Œåœ¨è“é²¸ä½“ç³»å†…è¢«ç§°ä¸ºâ€œè“é²¸ç®¡æ§å¹³å°ç³»ç»Ÿâ€ã€‚å®ƒæ˜¯è“é²¸å®ç°è‡ªåŠ¨åŒ–è¿ç»´èƒ½åŠ›çš„åŸºç¡€è®¾æ–½å±‚ã€‚
*   **è…¾è®¯äº‘æ¸¸æˆæœåŠ¡å™¨å¼•æ“ï¼ˆGame Server Engineï¼‰** ï¼šè¿™æ˜¯è…¾è®¯äº‘æä¾›çš„ä¸€é¡¹é¢å‘æ¸¸æˆå¼€å‘è€…çš„äº‘æœåŠ¡ï¼Œç”¨äºæ¸¸æˆæœåŠ¡å™¨çš„éƒ¨ç½²ã€æ‰©ç¼©å®¹å’Œç®¡ç†ã€‚æœç´¢ç»“æœæ˜ç¡®æŒ‡å‡ºï¼Œæ­¤GSEä¸â€œè“é²¸â€ä½“ç³»æ— ç›´æ¥å…³è”ã€‚
*   **å…¨è°ƒåº¦ä»¥å¤ªç½‘ï¼ˆGlobal Switching Engine/Global Scheduling Ethernetï¼‰** ï¼šè¿™æ˜¯ä¸€ç§ç”±ä¸­å›½ç§»åŠ¨ç ”ç©¶é™¢ç­‰æœºæ„æå‡ºçš„ã€æ—¨åœ¨è§£å†³æ™ºç®—ä¸­å¿ƒç½‘ç»œç“¶é¢ˆçš„æ–°å‹ä»¥å¤ªç½‘æ¶æ„æŠ€æœ¯ã€‚å®ƒæœ‰è‡ªèº«çš„æŠ€æœ¯ç™½çš®ä¹¦ï¼Œä½†ä¸è…¾è®¯è“é²¸çš„GSEæ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æŠ€æœ¯æ¦‚å¿µã€‚
*   **å…¶ä»–å«ä¹‰**ï¼šæœç´¢ç»“æœä¸­è¿˜é›¶æ˜Ÿå‡ºç°äº†GSEä½œä¸ºGoè¯­è¨€åˆ†è¯åº“ã€åœ°é¢å†›äº‹ç³»ç»Ÿç­‰æŒ‡ä»£ï¼Œå‡ä¸æœ¬æŠ¥å‘Šä¸»é¢˜æ— å…³ã€‚

æœ¬æŠ¥å‘Šåç»­æ‰€æœ‰â€œGSEâ€çš„è®ºè¿°ï¼Œå‡ç‰¹æŒ‡è“é²¸ä½“ç³»å†…çš„â€œé€šç”¨æœåŠ¡å¼•æ“â€ã€‚

**æ–‡æ¡£æ¥æº**
- [GSE(é€šç”¨æœåŠ¡å¼•æ“).md](file://wiki\GSE(é€šç”¨æœåŠ¡å¼•æ“).md)

## GSEæ ¸å¿ƒåŠŸèƒ½ä¸æ¶æ„

GSEæ˜¯è“é²¸çš„â€œé€šç”¨æœåŠ¡å¼•æ“â€ï¼Œå®šä½ä¸ºåº•å±‚çš„åˆ†å¸ƒå¼ç®¡æ§å¹³å°ï¼Œæ˜¯å®ç°å¤§è§„æ¨¡è‡ªåŠ¨åŒ–è¿ç»´çš„ç¥ç»ä¸­æ¢å’Œå‘½ä»¤ç®¡é“ï¼Œä¸ºä½œä¸šå¹³å°ç­‰ä¸Šå±‚åº”ç”¨æä¾›èƒ½åŠ›æ”¯æ’‘ã€‚

### **3. GSEçš„æŠ€æœ¯æ¶æ„ä¸ç»„ä»¶åˆ†æ**

#### **3.1. å·²çŸ¥çš„æ ¸å¿ƒç»„ä»¶**

å°½ç®¡å®Œæ•´çš„æ¶æ„å›¾ç¼ºå¤±ï¼Œä½†é€šè¿‡å¯¹å„æ–¹ä¿¡æ¯çš„æ‹¼å‡‘ï¼Œæˆ‘ä»¬å¯ä»¥è¯†åˆ«å‡ºGSEç³»ç»Ÿçš„å‡ ä¸ªå…³é”®ç»„æˆéƒ¨åˆ†ï¼š

*   **GSE Agent**ï¼šå®¢æˆ·ç«¯ä»£ç†ã€‚è¿™æ˜¯ä¸€ä¸ªå¿…é¡»é¢„å…ˆå®‰è£…åœ¨æ‰€æœ‰å—ç®¡æœåŠ¡å™¨ä¸Šçš„è½»é‡çº§ä»£ç†ç¨‹åºã€‚å®ƒè´Ÿè´£æ¥æ”¶æ¥è‡ªGSE Serverçš„æŒ‡ä»¤ï¼ˆå¦‚æ‰§è¡Œè„šæœ¬ã€ä¼ è¾“æ–‡ä»¶ï¼‰ï¼Œæ‰§è¡Œä»»åŠ¡ï¼Œå¹¶å°†ç»“æœä¸ŠæŠ¥ã€‚å®ƒæ˜¯GSEç®¡æ§èƒ½åŠ›çš„å»¶ä¼¸è§¦è§’ã€‚

*   **GSE Server (åå°)** ï¼šæœåŠ¡ç«¯é›†ç¾¤ã€‚è¿™æ˜¯GSEçš„æ§åˆ¶ä¸­æ¢ï¼Œä»¥é›†ç¾¤å½¢å¼éƒ¨ç½²ä»¥ä¿è¯é«˜å¯ç”¨å’Œé«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚å®ƒè‡³å°‘åŒ…å«ä»¥ä¸‹å­ç»„ä»¶ï¼š
    *   **TaskServer (`BK TaskServer`)**: ä»»åŠ¡å¤„ç†æœåŠ¡å™¨ï¼Œè´Ÿè´£æ¥æ”¶ã€è§£æå’Œè°ƒåº¦æ¥è‡ªä¸Šå±‚å¹³å°ï¼ˆå¦‚ä½œä¸šå¹³å°ï¼‰çš„ä»»åŠ¡è¯·æ±‚ã€‚
    *   **FileServer (`BK FileServer`)**: æ–‡ä»¶æœåŠ¡ï¼Œä¸“é—¨å¤„ç†æ–‡ä»¶åˆ†å‘ä»»åŠ¡ï¼Œç®¡ç†æ–‡ä»¶çš„ä¸­è½¬å’Œå­˜å‚¨ã€‚
    *   **å…¶ä»–åå°æœåŠ¡**: è¿˜å¯èƒ½åŒ…æ‹¬ä¸Agentç»´æŒé•¿è¿æ¥ã€ç®¡ç†AgentçŠ¶æ€ã€å¤„ç†æ•°æ®ä¸­è½¬ç­‰åŠŸèƒ½çš„å…¶ä»–å¾®æœåŠ¡ã€‚

*   **bk-nodeman (èŠ‚ç‚¹ç®¡ç†å™¨)** ï¼šè¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºç®¡ç†GSE Agentçš„è“é²¸å®˜æ–¹SaaSåº”ç”¨ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡èŠ‚ç‚¹ç®¡ç†å™¨çš„ç•Œé¢ï¼Œæ–¹ä¾¿åœ°å¯¹æ‰€æœ‰ä¸»æœºä¸Šçš„Agentè¿›è¡Œå®‰è£…ã€å¸è½½ã€å‡çº§ã€é…ç½®ç­‰æ“ä½œï¼Œæå¤§åœ°ç®€åŒ–äº†Agentçš„éƒ¨ç½²å’Œç»´æŠ¤å·¥ä½œã€‚

*   **ä¾èµ–ç»„ä»¶**ï¼šGSEçš„ç¨³å®šè¿è¡Œè¿˜ä¾èµ–äºä¸€äº›åŸºç¡€ä¸­é—´ä»¶ï¼Œå¦‚ä½¿ç”¨ZooKeeperè¿›è¡ŒæœåŠ¡å‘ç°å’Œåˆ†å¸ƒå¼åè°ƒï¼Œä½¿ç”¨Redisè¿›è¡Œæ•°æ®ç¼“å­˜ç­‰ã€‚

#### **3.2. ç»„ä»¶äº¤äº’ä¸é€šä¿¡åè®®ï¼šå…¬å¼€ä¿¡æ¯çš„ç¼ºå¤±**

**è¿™æ˜¯æœ¬æ¬¡ç ”ç©¶çš„ä¸€ä¸ªå…³é”®å‘ç°ï¼šå…³äºGSEå†…éƒ¨ç»„ä»¶ä¹‹é—´å¦‚ä½•äº¤äº’ï¼Œä»¥åŠå®ƒä»¬ä½¿ç”¨çš„å…·ä½“é€šä¿¡åè®®ï¼Œå‡ ä¹æ²¡æœ‰å…¬å¼€çš„è¯¦ç»†æ–‡æ¡£ã€‚**

é’ˆå¯¹â€œGSEç»„ä»¶äº¤äº’å’Œé€šä¿¡åè®®â€çš„å¤šæ¬¡æŸ¥è¯¢ï¼Œå‡æœªè¿”å›æœ‰æ•ˆç»“æœ (Query: è…¾è®¯è“é²¸GSEæ¨¡å—çš„ç»„ä»¶äº¤äº’å’Œé€šä¿¡åè®®è®¾è®¡æ˜¯ä»€ä¹ˆï¼Ÿ, Query: è…¾è®¯è“é²¸GSEæ¨¡å—å†…éƒ¨ç»„ä»¶äº¤äº’çš„è¯¦ç»†è®¾è®¡æ–‡æ¡£æ˜¯ä»€ä¹ˆï¼Ÿ, Query: Tencent BlueKing GSE component communication protocol specifications are described in which documents??)ã€‚æœç´¢ç»“æœä»…æä¾›äº†é€šç”¨çš„ç½‘ç»œåè®®æ¦‚å¿µï¼ˆå¦‚TCP/IPï¼‰æˆ–ä¸ç›¸å…³çš„åè®®æ ‡å‡†ï¼ˆå¦‚DVBé¢†åŸŸçš„GSEåè®®ï¼‰ã€‚

åŸºäºå…¶åŠŸèƒ½ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åšå‡ºå¦‚ä¸‹**åˆç†æ¨æ–­**ï¼š
1.  **Agentä¸Serverçš„é€šä¿¡**ï¼šGSE Agentä¸GSE Serverä¹‹é—´å¾ˆå¯èƒ½é‡‡ç”¨åŸºäºTCPçš„ã€åŠ å¯†çš„ã€æŒä¹…åŒ–çš„é•¿è¿æ¥ã€‚è¿™ç§è®¾è®¡å¯ä»¥ä¿è¯æŒ‡ä»¤ä¸‹å‘çš„ä½å»¶è¿Ÿå’Œå®æ—¶æ€§ï¼Œå¹¶èƒ½åŠæ—¶æ„ŸçŸ¥Agentçš„æ‰çº¿ã€‚
2.  **åè®®è®¾è®¡**ï¼šé€šä¿¡åè®®æ˜¯ç§æœ‰çš„ã€è‡ªå®šä¹‰çš„äºŒè¿›åˆ¶åè®®ï¼Œä»¥å®ç°é«˜æ•ˆçš„æ•°æ®åºåˆ—åŒ–å’Œä¼ è¾“ã€‚æŠ¥æ–‡å†…å®¹ä¼šåŒ…å«ä»»åŠ¡IDã€æŒ‡ä»¤ç±»å‹ã€åŠ å¯†è·è½½ã€æ ¡éªŒä¿¡æ¯ç­‰å­—æ®µã€‚
3.  **é«˜å¯ç”¨è®¾è®¡**ï¼šAgentåœ¨è¿æ¥GSE Serveræ—¶ï¼Œå¯èƒ½ä¼šé€šè¿‡æŸç§æœåŠ¡å‘ç°æœºåˆ¶ï¼ˆå¦‚è½®è¯¢DNSæˆ–ä»Zookeeperè·å–åœ°å€åˆ—è¡¨ï¼‰è¿æ¥åˆ°å¯ç”¨çš„ServerèŠ‚ç‚¹ï¼Œä»è€Œå®ç°æœåŠ¡ç«¯çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚

ç„¶è€Œï¼Œå¿…é¡»å¼ºè°ƒï¼Œä»¥ä¸Šå‡ä¸ºåŸºäºç³»ç»ŸåŠŸèƒ½çš„é€†å‘æ¨æµ‹ï¼Œç¼ºä¹å®˜æ–¹æ–‡æ¡£çš„ç›´æ¥è¯å®ã€‚è¿™ç§ä¿¡æ¯ç¼ºå¤±è¡¨æ˜ï¼ŒGSEçš„åº•å±‚é€šä¿¡æœºåˆ¶æ˜¯è“é²¸å¹³å°çš„æ ¸å¿ƒæŠ€æœ¯ç§˜å¯†ä¹‹ä¸€ã€‚

### **2.3. ä¸»è¦åŠŸèƒ½è¯¦è¿°**

åŸºäºç°æœ‰æœç´¢ç»“æœçš„åˆ†æï¼ŒGSEçš„æ ¸å¿ƒåŠŸèƒ½å¯ç»†åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

*   **å‘½ä»¤ä¸è„šæœ¬æ‰§è¡Œ**ï¼šè¿™æ˜¯GSEæœ€åŸºç¡€ä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚è“é²¸å¹³å°å®ç°çš„æ ¸å¿ƒåŸç†ä¾¿æ˜¯åŸºäºGSEæ„å»ºçš„â€œå‘½ä»¤ç®¡é“â€æ¥è¿œç¨‹æ‰§è¡Œå„ç±»Shellã€Pythonç­‰è„šæœ¬ã€‚è¿™ä½¿å¾—ç®¡ç†å‘˜å¯ä»¥åœ¨ç®¡æ§ç«¯å¯¹æˆåƒä¸Šä¸‡å°æœåŠ¡å™¨è¿›è¡Œæ‰¹é‡çš„å‘½ä»¤æ“ä½œï¼Œæ˜¯å®ç°è‡ªåŠ¨åŒ–è¿ç»´çš„åŸºç¡€ã€‚

*   **æ–‡ä»¶åˆ†å‘ä¸ä¼ è¾“**ï¼šGSEå…·å¤‡å¼ºå¤§çš„æ–‡ä»¶åˆ†å‘èƒ½åŠ›ï¼Œèƒ½å¤Ÿå°†æ–‡ä»¶ã€å®‰è£…åŒ…ã€é…ç½®æ–‡ä»¶ç­‰ä»æºæœåŠ¡å™¨é«˜æ•ˆåœ°ä¼ è¾“åˆ°å¤§é‡ç›®æ ‡æœåŠ¡å™¨ä¸Šã€‚è¿™ä¸€åŠŸèƒ½ç”±å…¶å†…éƒ¨çš„`BK FileServer`ç­‰ç»„ä»¶æ”¯æŒã€‚è¿™å¯¹äºæ‰¹é‡éƒ¨ç½²è½¯ä»¶ã€æ›´æ–°é…ç½®ç­‰åœºæ™¯è‡³å…³é‡è¦ã€‚

*   **AgentèŠ‚ç‚¹ç®¡ç†**ï¼šGSEçš„åŠŸèƒ½å®ç°ä¾èµ–äºä¸€ä¸ªéƒ¨ç½²åœ¨æ¯å°å—ç®¡æœåŠ¡å™¨ä¸Šçš„ä»£ç†ç¨‹åºâ€”â€”`GSE Agent`ã€‚GSEå¹³å°æœ¬èº«ï¼Œä»¥åŠè“é²¸ä½“ç³»ä¸­çš„`bk-nodeman`ï¼ˆèŠ‚ç‚¹ç®¡ç†å™¨ï¼‰æ¨¡å—ï¼Œæä¾›äº†å¯¹è¿™äº›Agentçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸç®¡ç†èƒ½åŠ›ï¼ŒåŒ…æ‹¬ï¼š
    *   **çŠ¶æ€æŸ¥è¯¢ä¸å¥åº·æ£€æŸ¥**ï¼šå®æ—¶ç›‘æ§Agentçš„å­˜æ´»çŠ¶æ€å’Œå¥åº·çŠ¶å†µã€‚
    *   **ç‰ˆæœ¬æ›´æ–°ä¸é…ç½®ç®¡ç†**ï¼šèƒ½å¤Ÿå¯¹Agentè¿›è¡Œè¿œç¨‹å‡çº§å’Œé…ç½®å˜æ›´ã€‚
    *   **è¿›ç¨‹ç®¡ç†**ï¼šå¯¹Agentè‡ªèº«çš„è¿›ç¨‹è¿›è¡Œç®¡ç†ï¼Œç¡®ä¿å…¶ç¨³å®šè¿è¡Œã€‚

*   **ä¸ºä¸Šå±‚SaaSæä¾›åŸºç¡€èƒ½åŠ›**ï¼šé™¤äº†æ”¯æ’‘ä½œä¸šå¹³å°ï¼ŒGSEä¹Ÿä¸ºè“é²¸ç”Ÿæ€ä¸­çš„å…¶ä»–ç»„ä»¶æä¾›æœåŠ¡ã€‚ä¾‹å¦‚ï¼Œè“é²¸æ—¥å¿—å¹³å°çš„æ•°æ®é‡‡é›†å™¨ä¾¿æ˜¯åŸºäºGSEçš„é‡‡é›†æ¡†æ¶è¿›è¡Œå¼€å‘çš„ï¼Œåˆ©ç”¨GSEçš„é€šé“èƒ½åŠ›å®ç°æ—¥å¿—æ•°æ®çš„å¯é ä¼ è¾“ã€‚

**æ–‡æ¡£æ¥æº**
- [GSE(é€šç”¨æœåŠ¡å¼•æ“).md](file://wiki\GSE(é€šç”¨æœåŠ¡å¼•æ“).md)

## GSEåœ¨bkmonitorä¸­çš„é›†æˆæœºåˆ¶

GSEï¼ˆGeneral Service Engineï¼Œé€šç”¨æœåŠ¡å¼•æ“ï¼‰æ˜¯è…¾è®¯è“é²¸ä½“ç³»ä¸­çš„**åº•å±‚ç®¡æ§å¹³å°**ï¼Œåœ¨bkmonitoré¡¹ç›®ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„åŸºç¡€è®¾æ–½è§’è‰²ã€‚

### 1. **æ•°æ®é‡‡é›†çš„åŸºç¡€é€šé“**

- **ç›‘æ§æ•°æ®ä¼ è¾“**ï¼šGSEä¸ºbkmonitoræä¾›ç¨³å®šã€é«˜æ•ˆçš„æ•°æ®ä¼ è¾“é€šé“ï¼Œå°†å„ä¸ªä¸»æœºä¸Šçš„ç›‘æ§æ•°æ®å®æ—¶ä¼ è¾“åˆ°ç›‘æ§å¹³å°
- **Agentç®¡ç†**ï¼šé€šè¿‡GSE Agentéƒ¨ç½²åœ¨è¢«ç›‘æ§çš„ä¸»æœºä¸Šï¼Œå®ç°ç›‘æ§æ•°æ®çš„è‡ªåŠ¨é‡‡é›†å’Œä¸ŠæŠ¥
- **å¤šæ•°æ®æºæ”¯æŒ**ï¼šæ”¯æŒæ—¶åºæ•°æ®ã€æ—¥å¿—æ•°æ®ã€äº‹ä»¶æ•°æ®ç­‰å¤šç§ç›‘æ§æ•°æ®ç±»å‹çš„é‡‡é›†

### 2. **å‘Šè­¦å¤„ç†çš„æ‰§è¡Œå¼•æ“**

- **å‘Šè­¦åŠ¨ä½œæ‰§è¡Œ**ï¼šå½“ç›‘æ§ç­–ç•¥è§¦å‘å‘Šè­¦æ—¶ï¼ŒGSEè´Ÿè´£æ‰§è¡Œç›¸åº”çš„å¤„ç†åŠ¨ä½œï¼Œå¦‚æ‰§è¡Œä¿®å¤è„šæœ¬ã€é‡å¯æœåŠ¡ç­‰
- **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒå¯¹å¤§é‡ä¸»æœºåŒæ—¶æ‰§è¡Œå‘Šè­¦å¤„ç†æ“ä½œï¼Œå®ç°å¤§è§„æ¨¡è¿ç»´è‡ªåŠ¨åŒ–
- **è·¨ç½‘ç»œæ‰§è¡Œ**ï¼šèƒ½å¤Ÿåœ¨å¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸­ï¼ˆè·¨äº‘ã€æ··åˆäº‘ï¼‰æ‰§è¡Œç›‘æ§å’Œå‘Šè­¦ç›¸å…³çš„æ“ä½œ

### 3. **ç›‘æ§é…ç½®çš„è‡ªåŠ¨åŒ–éƒ¨ç½²**

- **é…ç½®åˆ†å‘**ï¼šå°†ç›‘æ§é…ç½®æ–‡ä»¶ã€é‡‡é›†å™¨é…ç½®ç­‰æ‰¹é‡åˆ†å‘åˆ°ç›®æ ‡ä¸»æœº
- **æœåŠ¡éƒ¨ç½²**ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²ç›‘æ§ç›¸å…³çš„æœåŠ¡å’Œç»„ä»¶
- **ç‰ˆæœ¬ç®¡ç†**ï¼šå¯¹ç›‘æ§Agentå’Œç›¸å…³ç»„ä»¶è¿›è¡Œç‰ˆæœ¬å‡çº§å’Œç®¡ç†

### ğŸ”§ **æ ¸å¿ƒåŠŸèƒ½**

#### 1. **ç›‘æ§æ•°æ®é‡‡é›†é€šé“**

- **Agentå¿ƒè·³ç›‘æ§**ï¼šGSE Agentå®šæœŸå‘GSE Serverå‘é€å¿ƒè·³æ•°æ®ï¼Œbkmonitoré€šè¿‡[GetAgentStatus](file://d:\projects\bk-monitor\bkmonitor\api\gse\default.py#L410-L426) APIå®æ—¶ç›‘æ§ä¸»æœºçŠ¶æ€
- **è¿›ç¨‹çŠ¶æ€ç›‘æ§**ï¼šé€šè¿‡[GetProcStatus](file://d:\projects\bk-monitor\bkmonitor\api\gse\default.py#L429-L455) APIè·å–ä¸»æœºä¸Šè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€
- **ç³»ç»Ÿäº‹ä»¶æ”¶é›†**ï¼šæ”¶é›†è¯¸å¦‚ä¸»æœºé‡å¯ã€è¿›ç¨‹å¼‚å¸¸ã€ç½‘ç»œçŠ¶æ€ç­‰ç³»ç»Ÿçº§äº‹ä»¶

#### 2. **å‘Šè­¦å¤„ç†æ‰§è¡Œå¼•æ“**

- **è‡ªåŠ¨åŒ–å“åº”**ï¼šå½“ç›‘æ§ç­–ç•¥è§¦å‘å‘Šè­¦æ—¶ï¼ŒGSEè´Ÿè´£æ‰§è¡Œé¢„å®šä¹‰çš„å¤„ç†åŠ¨ä½œ
- **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒå¯¹å¤§é‡ä¸»æœºåŒæ—¶æ‰§è¡Œä¿®å¤è„šæœ¬ã€æœåŠ¡é‡å¯ç­‰æ“ä½œ
- **è·¨ç½‘ç»œæ‰§è¡Œ**ï¼šèƒ½å¤Ÿåœ¨å¤æ‚ç½‘ç»œç¯å¢ƒï¼ˆè·¨äº‘ã€æ··åˆäº‘ï¼‰ä¸­æ‰§è¡Œè¿ç»´æ“ä½œ

### ğŸ”„ **æ•°æ®æµè½¬è¿‡ç¨‹**

1. **æ•°æ®é‡‡é›†**ï¼šGSE Agentåœ¨å„ä¸»æœºä¸Šé‡‡é›†ç›‘æ§æ•°æ®
2. **æ•°æ®ä¼ è¾“**ï¼šé€šè¿‡GSEçš„æ•°æ®è·¯ç”±ç³»ç»Ÿå°†æ•°æ®ä¼ è¾“åˆ°bkmonitor
3. **æ•°æ®å¤„ç†**ï¼šbkmonitorå¯¹æ”¶åˆ°çš„æ•°æ®è¿›è¡Œæ¸…æ´—ã€èšåˆå’Œåˆ†æ
4. **å‘Šè­¦ç”Ÿæˆ**ï¼šåŸºäºé¢„è®¾ç­–ç•¥ç”Ÿæˆå‘Šè­¦äº‹ä»¶
5. **åŠ¨ä½œæ‰§è¡Œ**ï¼šé€šè¿‡GSEæ‰§è¡Œç›¸åº”çš„å¤„ç†åŠ¨ä½œ

ç®€è€Œè¨€ä¹‹ï¼Œ**GSEæ˜¯bkmonitorç³»ç»Ÿçš„"ç¥ç»ç³»ç»Ÿ"**ï¼Œå®ƒè¿æ¥ç€ç›‘æ§ä¸­å¿ƒå’Œå„ä¸ªè¢«ç›‘æ§èŠ‚ç‚¹ï¼Œå®ç°äº†ç›‘æ§æ•°æ®çš„åŒå‘æµé€šå’Œè‡ªåŠ¨åŒ–è¿ç»´æ“ä½œçš„ç²¾ç¡®æ‰§è¡Œï¼Œæ˜¯æ•´ä¸ªç›‘æ§å¹³å°èƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„åŸºç¡€æ”¯æ’‘ã€‚

**æ–‡æ¡£æ¥æº**
- [GSE(é€šç”¨æœåŠ¡å¼•æ“).md](file://wiki\GSE(é€šç”¨æœåŠ¡å¼•æ“).md)

## ä»»åŠ¡åˆ†å‘ç»“æœå›è°ƒä¸é”™è¯¯å¤„ç†

### ä»»åŠ¡åˆ†å‘æµç¨‹

GSEçš„ä»»åŠ¡åˆ†å‘æµç¨‹æ˜¯å…¶ä½œä¸ºç®¡æ§å¹³å°çš„æ ¸å¿ƒã€‚å½“ä¸Šå±‚åº”ç”¨ï¼ˆå¦‚bkmonitorï¼‰éœ€è¦æ‰§è¡Œä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œå®ƒä¼šé€šè¿‡APIå°†ä»»åŠ¡è¯·æ±‚å‘é€ç»™GSE Serverã€‚GSE Serverä¸­çš„TaskServerç»„ä»¶è´Ÿè´£æ¥æ”¶å’Œè§£æè¯¥è¯·æ±‚ï¼Œç„¶åæ ¹æ®ç›®æ ‡ä¸»æœºåˆ—è¡¨ï¼Œå°†ä»»åŠ¡æŒ‡ä»¤é€šè¿‡åŠ å¯†çš„é•¿è¿æ¥åˆ†å‘ç»™å¯¹åº”çš„GSE Agentã€‚Agentæ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œä¼šåœ¨æœ¬åœ°æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼ˆå¦‚è¿è¡Œè„šæœ¬ã€é‡‡é›†æ•°æ®ï¼‰ï¼Œå¹¶å°†æ‰§è¡Œç»“æœå’ŒçŠ¶æ€ä¸ŠæŠ¥ç»™GSE Serverã€‚

### ç»“æœå›è°ƒæœºåˆ¶

GSEé€šè¿‡å¼‚æ­¥å›è°ƒæœºåˆ¶æ¥å¤„ç†ä»»åŠ¡ç»“æœã€‚ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼ŒGSE Agentä¼šå°†ç»“æœï¼ˆåŒ…æ‹¬æ‰§è¡Œæ—¥å¿—ã€è¿”å›ç ã€è¾“å‡ºå†…å®¹ç­‰ï¼‰æ‰“åŒ…å¹¶ä¸ŠæŠ¥ã€‚GSE Serveræ¥æ”¶åˆ°ç»“æœåï¼Œä¼šæ ¹æ®ä»»åŠ¡IDå°†å…¶ä¸åŸå§‹è¯·æ±‚è¿›è¡ŒåŒ¹é…ï¼Œå¹¶é€šè¿‡é¢„è®¾çš„å›è°ƒæ¥å£æˆ–æ¶ˆæ¯é˜Ÿåˆ—é€šçŸ¥å‘èµ·æ–¹ï¼ˆå¦‚bkmonitorï¼‰ã€‚åœ¨ä»£ç å±‚é¢ï¼Œ`gse_process_event.py`ä¸­çš„`GseProcessEventRecord`ç±»å±•ç¤ºäº†å¦‚ä½•å¤„ç†GSEä¸ŠæŠ¥çš„äº‹ä»¶æ•°æ®ï¼Œå…¶`flat`æ–¹æ³•å°†åŸå§‹æ•°æ®è§£æä¸ºæ ‡å‡†æ ¼å¼ï¼Œä¸ºåç»­çš„å‘Šè­¦å¤„ç†æä¾›è¾“å…¥ã€‚

```mermaid
sequenceDiagram
participant bkmonitor as bkmonitor
participant GSE_Server as GSE Server
participant GSE_Agent as GSE Agent
bkmonitor->>GSE_Server : æäº¤ä»»åŠ¡è¯·æ±‚ (APIè°ƒç”¨)
GSE_Server->>GSE_Agent : åˆ†å‘ä»»åŠ¡æŒ‡ä»¤ (é€šè¿‡é•¿è¿æ¥)
GSE_Agent->>GSE_Agent : æ‰§è¡Œè„šæœ¬/å‘½ä»¤
GSE_Agent->>GSE_Server : ä¸ŠæŠ¥ä»»åŠ¡ç»“æœ
GSE_Server->>bkmonitor : å›è°ƒé€šçŸ¥ (å¼‚æ­¥)
```

**å›¾ç¤ºæ¥æº**
- [gse_process_event.py](file://bkmonitor\alarm_backends\service\access\event\records\gse_process_event.py)
- [default.py](file://bkmonitor\api\gse\default.py)

### é”™è¯¯å¤„ç†æœºåˆ¶

GSEçš„é”™è¯¯å¤„ç†æœºåˆ¶è´¯ç©¿äºæ•´ä¸ªä»»åŠ¡ç”Ÿå‘½å‘¨æœŸã€‚åœ¨ä»£ç å®ç°ä¸­ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°å¤šç§é”™è¯¯å¤„ç†ç­–ç•¥ï¼š

1.  **è¾“å…¥éªŒè¯**ï¼šåœ¨`GseProcessEventRecord`ç±»çš„`check`æ–¹æ³•ä¸­ï¼Œä¼šå¯¹åŸå§‹æ•°æ®è¿›è¡ŒéªŒè¯ï¼Œæ£€æŸ¥æ˜¯å¦å­˜åœ¨`event_name`ç­‰å…³é”®å­—æ®µï¼Œå¦‚æœéªŒè¯å¤±è´¥ï¼Œä¼šè®°å½•è­¦å‘Šæ—¥å¿—ã€‚
2.  **å¼‚å¸¸æ•è·**ï¼šåœ¨`flat`æ–¹æ³•ä¸­ï¼Œä½¿ç”¨äº†`try-except`å—æ¥æ•è·å¯èƒ½å‘ç”Ÿçš„å¼‚å¸¸ï¼ˆå¦‚æ—¶é—´è½¬æ¢é”™è¯¯ï¼‰ï¼Œå¹¶è®°å½•è¯¦ç»†çš„å¼‚å¸¸æ—¥å¿—ï¼Œç¡®ä¿ç¨‹åºä¸ä¼šå› å•ä¸ªä»»åŠ¡çš„é”™è¯¯è€Œå´©æºƒã€‚
3.  **æ—¥å¿—è®°å½•**ï¼šç³»ç»Ÿä½¿ç”¨`logging`æ¨¡å—è¿›è¡Œè¯¦ç»†çš„æ—¥å¿—è®°å½•ã€‚ä¾‹å¦‚ï¼Œåœ¨`gse_tool.py`ä¸­ï¼Œå½“è·å–ä¸»æœºAgentçŠ¶æ€å¤±è´¥æ—¶ï¼Œä¼šä½¿ç”¨`logger.error`è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œä¾¿äºåç»­æ’æŸ¥ã€‚

```mermaid
flowchart TD
A[ä»»åŠ¡å¼€å§‹] --> B{è¾“å…¥æ•°æ®éªŒè¯}
B --> |éªŒè¯å¤±è´¥| C[è®°å½•è­¦å‘Šæ—¥å¿—]
B --> |éªŒè¯æˆåŠŸ| D[æ‰§è¡Œæ ¸å¿ƒé€»è¾‘]
D --> E{å‘ç”Ÿå¼‚å¸¸?}
E --> |æ˜¯| F[æ•è·å¼‚å¸¸]
F --> G[è®°å½•è¯¦ç»†é”™è¯¯æ—¥å¿—]
G --> H[è¿”å›ç©ºç»“æœæˆ–é»˜è®¤å€¼]
E --> |å¦| I[è¿”å›å¤„ç†ç»“æœ]
C --> J[è¿”å›]
H --> J
I --> J
```

**å›¾ç¤ºæ¥æº**
- [gse_process_event.py](file://bkmonitor\alarm_backends\service\access\event\records\gse_process_event.py)
- [gse_tool.py](file://bkmonitor\bkm_ipchooser\tools\gse_tool.py)

**æ–‡æ¡£æ¥æº**
- [gse_process_event.py](file://bkmonitor\alarm_backends\service\access\event\records\gse_process_event.py)
- [gse_event.py](file://bkmonitor\alarm_backends\service\access\event\records\gse_event.py)
- [gse_tool.py](file://bkmonitor\bkm_ipchooser\tools\gse_tool.py)

## APIæ¥å£æ–‡æ¡£

GSEé€šè¿‡ä¸€ç³»åˆ—APIç«¯ç‚¹æä¾›å…¶æ ¸å¿ƒåŠŸèƒ½ã€‚è¿™äº›APIä¸»è¦å®šä¹‰åœ¨`api/gse/default.py`æ–‡ä»¶ä¸­ã€‚

### ä»»åŠ¡æäº¤ç«¯ç‚¹

- **`AddStreamTo`**: æ–°å¢æ•°æ®æ¥æ”¶ç«¯é…ç½®ã€‚ç”¨äºå®šä¹‰æ•°æ®ä¸ŠæŠ¥çš„ç›®æ ‡ï¼ˆå¦‚Kafkaã€Redisï¼‰ã€‚
    - **æ–¹æ³•**: POST
    - **è·¯å¾„**: `config_add_streamto/` æˆ– `data/add_streamto`
    - **å‚æ•°**: åŒ…å«æ¥æ”¶ç«¯åç§°ã€ç±»å‹ï¼ˆkafka, redis, pulsar, fileï¼‰ã€ä»¥åŠå¯¹åº”çš„ç›®æ ‡åœ°å€å’Œè®¤è¯ä¿¡æ¯ã€‚

### çŠ¶æ€æŸ¥è¯¢ç«¯ç‚¹

- **`GetAgentStatus`**: æŸ¥è¯¢ä¸»æœºAgentçŠ¶æ€ã€‚
    - **æ–¹æ³•**: POST
    - **è·¯å¾„**: `get_agent_status`
    - **å‚æ•°**: `hosts` (ä¸»æœºåˆ—è¡¨ï¼ŒåŒ…å«IPå’Œäº‘åŒºåŸŸID)
    - **ç”¨é€”**: å®æ—¶ç›‘æ§ä¸»æœºAgentçš„å­˜æ´»çŠ¶æ€ã€‚

- **`GetProcStatus`**: æŸ¥è¯¢ä¸»æœºä¸Šè¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€ã€‚
    - **æ–¹æ³•**: POST
    - **è·¯å¾„**: `get_proc_status`
    - **å‚æ•°**: `hosts` (ä¸»æœºåˆ—è¡¨), `meta` (åŒ…å«è¿›ç¨‹åç§°ç­‰å…ƒä¿¡æ¯)
    - **ç”¨é€”**: ç›‘æ§ç‰¹å®šè¿›ç¨‹ï¼ˆå¦‚ç›‘æ§Agentï¼‰çš„è¿è¡Œæƒ…å†µã€‚

### ç»“æœè·å–ç«¯ç‚¹

- **`QueryStreamTo`**: æŸ¥è¯¢å·²é…ç½®çš„æ•°æ®æ¥æ”¶ç«¯ã€‚
    - **æ–¹æ³•**: POST
    - **è·¯å¾„**: `config_query_streamto/` æˆ– `data/query_streamto`
    - **å‚æ•°**: `condition` (æŸ¥è¯¢æ¡ä»¶ï¼Œå¦‚å¹³å°åç§°)
    - **ç”¨é€”**: è·å–æ•°æ®ä¸ŠæŠ¥é…ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚

- **`QueryRoute`**: æŸ¥è¯¢è·¯ç”±é…ç½®ã€‚
    - **æ–¹æ³•**: POST
    - **è·¯å¾„**: `config_query_route/` æˆ– `data/query_route`
    - **å‚æ•°**: `condition` (åŒ…å«è·¯ç”±IDå’Œå¹³å°åç§°)
    - **ç”¨é€”**: æŸ¥çœ‹æ•°æ®ä»Agentåˆ°æ¥æ”¶ç«¯çš„è·¯ç”±è§„åˆ™ã€‚

```mermaid
classDiagram
class GseBaseResource {
+base_url : str
+module_name : str
}
class AddStreamTo {
+action : str
+method : str
+RequestSerializer : Serializer
}
class GetAgentStatus {
+action : str
+method : str
+RequestSerializer : Serializer
}
class GetProcStatus {
+action : str
+method : str
+RequestSerializer : Serializer
}
class QueryStreamTo {
+action : str
+method : str
+RequestSerializer : Serializer
}
class QueryRoute {
+action : str
+method : str
+RequestSerializer : Serializer
}
GseBaseResource <|-- AddStreamTo
GseBaseResource <|-- GetAgentStatus
GseBaseResource <|-- GetProcStatus
GseBaseResource <|-- QueryStreamTo
GseBaseResource <|-- QueryRoute
```

**å›¾ç¤ºæ¥æº**
- [default.py](file://bkmonitor\api\gse\default.py)

**æ–‡æ¡£æ¥æº**
- [default.py](file://bkmonitor\api\gse\default.py)

## GSEé€šé“ä¸æƒé™ç­–ç•¥é…ç½®

### GSEé€šé“é…ç½®

GSEé€šé“çš„é…ç½®ä¸»è¦é€šè¿‡APIå®Œæˆï¼Œæ ¸å¿ƒæ˜¯å®šä¹‰æ•°æ®çš„â€œæ¥æ”¶ç«¯â€ï¼ˆStreamToï¼‰å’Œâ€œè·¯ç”±â€ï¼ˆRouteï¼‰ã€‚

1.  **é…ç½®æ•°æ®æ¥æ”¶ç«¯**ï¼šä½¿ç”¨`AddStreamTo` APIï¼ŒæŒ‡å®šæ•°æ®ä¸ŠæŠ¥çš„ç›®æ ‡ç³»ç»Ÿã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªKafkaæ¥æ”¶ç«¯ï¼Œæä¾›Kafkaé›†ç¾¤çš„åœ°å€ã€ç«¯å£ã€SASLè®¤è¯ä¿¡æ¯å’ŒTopicåç§°ã€‚
2.  **é…ç½®æ•°æ®è·¯ç”±**ï¼šä½¿ç”¨`AddRoute` APIï¼Œå°†ç‰¹å®šç±»å‹çš„æ•°æ®ï¼ˆé€šè¿‡è¿‡æ»¤æ¡ä»¶å®šä¹‰ï¼‰è·¯ç”±åˆ°å·²é…ç½®çš„æ¥æ”¶ç«¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†æ‰€æœ‰æ¥è‡ªâ€œbkmonitorâ€å¹³å°çš„ç›‘æ§äº‹ä»¶æ•°æ®è·¯ç”±åˆ°åä¸ºâ€œbkmonitor_kafkaâ€çš„æ¥æ”¶ç«¯ã€‚

è¿™ç§é…ç½®æ–¹å¼å®ç°äº†æ•°æ®æºä¸æ•°æ®ç›®çš„åœ°çš„è§£è€¦ï¼Œä½¿å¾—æ•°æ®æµå‘å¯ä»¥çµæ´»è°ƒæ•´ã€‚

### æƒé™ç­–ç•¥

è™½ç„¶ä»£ç ä¸­æœªç›´æ¥ä½“ç°æƒé™ç­–ç•¥çš„å®ç°ç»†èŠ‚ï¼Œä½†å¯ä»¥æ¨æ–­å…¶æƒé™ä½“ç³»æ˜¯åŸºäºè“é²¸å¹³å°çš„ç»Ÿä¸€IAMï¼ˆèº«ä»½ä¸è®¿é—®ç®¡ç†ï¼‰ç³»ç»Ÿã€‚ç”¨æˆ·æˆ–åº”ç”¨åœ¨è°ƒç”¨GSE APIæ—¶ï¼Œå¿…é¡»æä¾›æœ‰æ•ˆçš„èº«ä»½å‡­è¯ï¼ˆå¦‚APIå¯†é’¥æˆ–Tokenï¼‰ï¼Œç³»ç»Ÿä¼šæ ¹æ®é¢„è®¾çš„æƒé™ç­–ç•¥ï¼ˆå¦‚â€œä½œä¸šå¹³å°â€æœ‰æƒé™æ‰§è¡Œè„šæœ¬ï¼Œâ€œç›‘æ§å¹³å°â€æœ‰æƒé™æŸ¥è¯¢çŠ¶æ€ï¼‰æ¥å†³å®šæ˜¯å¦å…è®¸è¯¥æ“ä½œã€‚`RequestSerializer`ä¸­çš„`operator_name`å­—æ®µä¹Ÿè¡¨æ˜äº†æ“ä½œè€…èº«ä»½çš„è®°å½•ï¼Œè¿™æ˜¯å®¡è®¡å’Œæƒé™è¿½æº¯çš„åŸºç¡€ã€‚

**æ–‡æ¡£æ¥æº**
- [default.py](file://bkmonitor\api\gse\default.py)
- [GSE(é€šç”¨æœåŠ¡å¼•æ“).md](file://wiki\GSE(é€šç”¨æœåŠ¡å¼•æ“).md)

## å®é™…åº”ç”¨åœºæ™¯

### è‡ªå®šä¹‰è„šæœ¬æ‰§è¡Œ

GSEçš„å¼ºå¤§è„šæœ¬æ‰§è¡Œèƒ½åŠ›æ˜¯å…¶æœ€å…¸å‹çš„åº”ç”¨åœºæ™¯ã€‚åœ¨bkmonitorä¸­ï¼Œå½“ç›‘æ§ç­–ç•¥è§¦å‘å‘Šè­¦æ—¶ï¼Œå¯ä»¥é…ç½®GSEæ‰§è¡Œè‡ªå®šä¹‰çš„ä¿®å¤è„šæœ¬ã€‚ä¾‹å¦‚ï¼Œå½“æ£€æµ‹åˆ°æŸä¸ªæœåŠ¡è¿›ç¨‹åœæ­¢æ—¶ï¼ŒGSEå¯ä»¥è‡ªåŠ¨ç™»å½•åˆ°ç›®æ ‡ä¸»æœºï¼Œæ‰§è¡Œ`systemctl restart service_name`å‘½ä»¤æ¥é‡å¯æœåŠ¡ã€‚åœ¨ä»£ç ä¸­ï¼Œ`resources.py`æ–‡ä»¶å±•ç¤ºäº†å¦‚ä½•é€šè¿‡è°ƒç”¨`fast_execute_script` APIæ¥å¿«é€Ÿæ‰§è¡Œè„šæœ¬ï¼Œå¹¶è·å–æ‰§è¡Œç»“æœã€‚

### æ‰¹é‡æ•°æ®é‡‡é›†

GSEæ˜¯å®ç°å¤§è§„æ¨¡æ‰¹é‡æ•°æ®é‡‡é›†çš„ç†æƒ³å·¥å…·ã€‚é€šè¿‡`GetAgentStatus`å’Œ`GetProcStatus`ç­‰APIï¼Œbkmonitorå¯ä»¥åŒæ—¶å‘æˆåƒä¸Šä¸‡å°ä¸»æœºå‘èµ·çŠ¶æ€æŸ¥è¯¢è¯·æ±‚ï¼ŒGSE Serverä¼šé«˜æ•ˆåœ°å°†è¿™äº›è¯·æ±‚åˆ†å‘ç»™å¯¹åº”çš„Agentï¼Œå¹¶æ±‡æ€»è¿”å›ç»“æœã€‚`processor.py`æ–‡ä»¶ä¸­çš„`process`æ–¹æ³•å±•ç¤ºäº†å¦‚ä½•å¤„ç†æ‰¹é‡æ•°æ®ï¼Œå®ƒä½¿ç”¨Redisä½œä¸ºä¸­é—´ä»¶æ¥åè°ƒå’Œç­‰å¾…æ‰€æœ‰åˆ†æ‰¹ä»»åŠ¡çš„ç»“æœï¼Œç¡®ä¿æ•°æ®å¤„ç†çš„å®Œæ•´æ€§å’Œæ•ˆç‡ã€‚

**æ–‡æ¡£æ¥æº**
- [resources.py](file://bkmonitor\packages\monitor_web\commons\job\resources.py)
- [processor.py](file://bkmonitor\alarm_backends\service\access\data\processor.py)
- [GSE(é€šç”¨æœåŠ¡å¼•æ“).md](file://wiki\GSE(é€šç”¨æœåŠ¡å¼•æ“).md)

## å¸¸è§é—®é¢˜æ’æŸ¥ä¸ç›‘æ§å»ºè®®

### å¸¸è§é—®é¢˜æ’æŸ¥

1.  **è¿æ¥è¶…æ—¶**ï¼šè¿™é€šå¸¸ç”±ç½‘ç»œé—®é¢˜æˆ–GSE Serverè¿‡è½½å¼•èµ·ã€‚æ’æŸ¥æ­¥éª¤åŒ…æ‹¬ï¼š
    *   æ£€æŸ¥ç›®æ ‡ä¸»æœºçš„ç½‘ç»œè¿é€šæ€§ã€‚
    *   æŸ¥çœ‹GSE Serverå’ŒAgentçš„æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦æœ‰è¿æ¥è¢«æ‹’ç»æˆ–è¶…æ—¶çš„è®°å½•ã€‚
    *   æ£€æŸ¥GSE Serverçš„è´Ÿè½½æƒ…å†µï¼Œç¡®è®¤å…¶èµ„æºï¼ˆCPUã€å†…å­˜ï¼‰æ˜¯å¦å……è¶³ã€‚

2.  **ä»»åŠ¡å¤±è´¥**ï¼šä»»åŠ¡æ‰§è¡Œå¤±è´¥å¯èƒ½æœ‰å¤šç§åŸå› ï¼š
    *   **è„šæœ¬è¯­æ³•é”™è¯¯**ï¼šæ£€æŸ¥æäº¤çš„è„šæœ¬å†…å®¹æ˜¯å¦æ­£ç¡®ã€‚
    *   **æƒé™ä¸è¶³**ï¼šç¡®è®¤Agentåœ¨ç›®æ ‡ä¸»æœºä¸Šæ˜¯å¦æœ‰è¶³å¤Ÿçš„æƒé™æ‰§è¡Œè¯¥æ“ä½œã€‚
    *   **Agentç¦»çº¿**ï¼šé€šè¿‡`GetAgentStatus` APIæ£€æŸ¥ç›®æ ‡ä¸»æœºçš„AgentçŠ¶æ€ï¼Œå¦‚æœAgentç¦»çº¿ï¼Œåˆ™ä»»åŠ¡æ— æ³•æ‰§è¡Œã€‚
    *   **ä»£ç å±‚é¢**ï¼šå¦‚`gse_tool.py`ä¸­çš„`fill_agent_status`å‡½æ•°ï¼Œå½“è°ƒç”¨`api.node_man.ipchooser_host_detail`å¤±è´¥æ—¶ï¼Œä¼šæ•è·å¼‚å¸¸å¹¶è®°å½•`"è·å–ä¸»æœºagentçŠ¶æ€å¤±è´¥"`çš„é”™è¯¯æ—¥å¿—ï¼Œè¿™æ˜¯æ’æŸ¥æ­¤ç±»é—®é¢˜çš„ç›´æ¥çº¿ç´¢ã€‚

### ç›‘æ§æŒ‡æ ‡å»ºè®®

ä¸ºäº†ç¡®ä¿GSEé€šé“çš„ç¨³å®šè¿è¡Œï¼Œå»ºè®®ç›‘æ§ä»¥ä¸‹å…³é”®æŒ‡æ ‡ï¼š

- **GSE Serveræ€§èƒ½æŒ‡æ ‡**ï¼šCPUä½¿ç”¨ç‡ã€å†…å­˜å ç”¨ã€ç½‘ç»œI/Oã€ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦ã€‚
- **AgentçŠ¶æ€æŒ‡æ ‡**ï¼šAgentåœ¨çº¿ç‡ã€å¿ƒè·³å»¶è¿Ÿã€ç‰ˆæœ¬åˆ†å¸ƒã€‚
- **ä»»åŠ¡æ‰§è¡ŒæŒ‡æ ‡**ï¼šä»»åŠ¡æäº¤æˆåŠŸç‡ã€å¹³å‡æ‰§è¡Œæ—¶é—´ã€å¤±è´¥ä»»åŠ¡æ•°ã€‚
- **APIè°ƒç”¨æŒ‡æ ‡**ï¼š`GetAgentStatus`ã€`GetProcStatus`ç­‰å…³é”®APIçš„è°ƒç”¨é¢‘ç‡ã€å“åº”æ—¶é—´å’Œé”™è¯¯ç‡ã€‚

é€šè¿‡ç›‘æ§è¿™äº›æŒ‡æ ‡ï¼Œå¯ä»¥åŠæ—¶å‘ç°æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆå’Œç³»ç»Ÿæ•…éšœï¼Œä¿éšœç›‘æ§ç³»ç»Ÿçš„å¯é è¿è¡Œã€‚

**æ–‡æ¡£æ¥æº**
- [gse_process_event.py](file://bkmonitor\alarm_backends\service\access\event\records\gse_process_event.py)
- [gse_event.py](file://bkmonitor\alarm_backends\service\access\event\records\gse_event.py)
- [gse_tool.py](file://bkmonitor\bkm_ipchooser\tools\gse_tool.py)
- [GSE(é€šç”¨æœåŠ¡å¼•æ“).md](file://wiki\GSE(é€šç”¨æœåŠ¡å¼•æ“).md)